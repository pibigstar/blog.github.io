<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/32x32.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/16x16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="派大星, pibigstar,blog,go">










<meta name="keywords" content="派大星,pibigstar">
<meta property="og:type" content="website">
<meta property="og:title" content="派大星的博客">
<meta property="og:url" content="http://pibigstar.com/page/20/index.html">
<meta property="og:site_name" content="派大星的博客">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="派大星的博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://pibigstar.com/page/20/">





  <title>派大星的博客 - 很多事情不是会了才能做，而是做了才能学会</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">派大星的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">很多事情不是会了才能做，而是做了才能学会</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-schedule">
          <a href="/schedule/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>
            
            Schedule
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-sitemap">
          <a href="/sitemap.xml" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>
            
            Sitemap
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/09/29/MySQL字段操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/MySQL字段操作/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T22:56:39+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: MySQL字段操作<br>date: 2019-09-29 22:10:31<br>tags: [mysql]<br>categories: mysql</p>
<p>添加列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">add</span> <span class="keyword">COLUMN</span> 列名 <span class="built_in">VARCHAR</span>(<span class="number">2</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'注释'</span>;</span><br></pre></td></tr></table></figure>

<p>删除列</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">column</span> 列名;</span><br></pre></td></tr></table></figure>

<p>更新列名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">change</span> 列名 新列名 <span class="built_in">varchar</span>(<span class="number">30</span>);</span><br></pre></td></tr></table></figure>

<p>修改列属性</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">modify</span> 列名 <span class="built_in">varchar</span>(<span class="number">22</span>);</span><br></pre></td></tr></table></figure>

<p>修改字段默认值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">alter</span> 字段名 <span class="keyword">set</span> <span class="keyword">default</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p>删除字段默认值</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">alter</span> 列名 <span class="keyword">drop</span> <span class="keyword">default</span>;</span><br></pre></td></tr></table></figure>

<p>修改表名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">rename</span> <span class="keyword">to</span> 新表名;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/09/29/MySQL实战45讲学习笔记（1~7）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/MySQL实战45讲学习笔记（1~7）/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T22:56:39+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: MySQL实战45讲学习笔记（1~7）<br>date: 2019-04-10 22:10:31<br>tags: [mysql,表级锁]<br>categories: 数据库,面试,mysql</p>
<p>本文为极客时间《MySQL实战45讲》的总结笔记，如有侵权，请通知我，将立马删除。建议大家去购买这套课程，真的是物有所值。<br><img src="https://img-blog.csdnimg.cn/20190116094356143.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2p1bm1veGk=,size_16,color_FFFFFF,t_70" alt></p>
<h2 id="1、2一条语句的执行过程"><a href="#1、2一条语句的执行过程" class="headerlink" title="1、2一条语句的执行过程"></a>1、2一条语句的执行过程</h2><h4 id="1-Mysql结构"><a href="#1-Mysql结构" class="headerlink" title="1. Mysql结构"></a>1. Mysql结构</h4><p>数据库总共分为两大部分：Server层和存储层，其中Server层又分为：连接器、（查询缓存）、分析器、优化器和执行器。存储层是以插件的形式，常见的有InnoDB和MyISAM。</p>
<h4 id="2-查询语句（select-from-T-where-id-2）"><a href="#2-查询语句（select-from-T-where-id-2）" class="headerlink" title="2. 查询语句（select * from T where id = 2）"></a>2. 查询语句（select * from T where id = 2）</h4><ol>
<li>通过连接器获取连接</li>
<li>查看语句是存在于查询缓存中，如果存在则直接返回，不存在则进行 步骤3，Mysql 8.0版本之后已经去掉了查询缓存功能</li>
<li>通过分析器判断SQL语句是否正确（要做什么）</li>
<li>通过优化器判断使用哪个索引去查询（怎么做）</li>
<li>执行器判断是否拥有该表权限，如果有则调用存储引擎的拿第一条数据的接口，判断id是否是等于2，如果不等则调用拿下一条数据的接口，如果等于则将结果放入到结果集中，继续判断下一条。</li>
</ol>
<h4 id="3-日志"><a href="#3-日志" class="headerlink" title="3. 日志"></a>3. 日志</h4><p>mysql中的日志分为两个部分：redo log 和 binlog。<br>redo log ：这个服务于存储引擎， 这个是InnoDB引擎特有的日志系统<br>binlog : 这个服务于Server层，是所有引擎都可以使用的。</p>
<blockquote>
<p>redo log 是为了减少磁盘的读写和crash-safe而产生的，它记录了更新、删除、插入语句，当Mysql空闲时就从redo log中读取这些日志，把数据更新到磁盘中。而binlog是记录做了哪些事情，当我们恢复备份信息时，可以读取binlog中的记录，然后去执行redo log中的记录去恢复信息。</p>
</blockquote>
<h4 id="4-更新语句（update-T-c-c-1-where-id-2）"><a href="#4-更新语句（update-T-c-c-1-where-id-2）" class="headerlink" title="4. 更新语句（update T c = c+1 where id = 2）"></a>4. 更新语句（update T c = c+1 where id = 2）</h4><ol>
<li>执行器找存储引擎拿到 id = 2 这一行记录，id是主键，存储引擎直接通过树搜索找到这一行记录，如果这一行所在的数据页在内存中则直接返回，如果不在则去读取磁盘到内存中再返回。</li>
<li>执行器拿到这一行记录，将 c 列的值 +1 得到一行新数据，然后再调用存储引擎接口写入这行新数据</li>
<li>存储引擎拿到这行数据写入到内存中，同时将这个更新操作记录到redo log日志中，此时redo log处于<code>prepare</code>状态，并告诉执行器可以提交事务了</li>
<li>执行器生成这个操作的binlog，并把binlog写入到磁盘中。</li>
<li>执行器调用存储引擎的提交事务的接口，存储引擎把刚刚写入的redo log日志状态更新为<code>commit</code>，这也就是<code>两阶段提交</code></li>
</ol>
<h2 id="3-事务隔离"><a href="#3-事务隔离" class="headerlink" title="3. 事务隔离"></a>3. 事务隔离</h2><h4 id="3-1-事务隔离的特性"><a href="#3-1-事务隔离的特性" class="headerlink" title="3.1 事务隔离的特性"></a>3.1 事务隔离的特性</h4><p>ACID：原子性、一致性、隔离性、持久性</p>
<h4 id="3-2-事务的隔离级别"><a href="#3-2-事务的隔离级别" class="headerlink" title="3.2 事务的隔离级别"></a>3.2 事务的隔离级别</h4><ul>
<li>读未提交：一个事务还未提交，其他事务就可以看到它做的更改</li>
<li>读已提交：一个事务在提交之后，其他事务才能看到它的更改</li>
<li>可重复读：一个事务是启动和提交之间读到数据是一致的，它在未提交时，其他事务无法看到它做的更改</li>
<li>串行化：对同一行记录，写会加写锁，读会加读锁，当出现读写锁冲突的时候，后访问的事务必须等前一个事务执行完才能继续执行。</li>
</ul>
<p>修改隔离级别：设置参数：<code>transaction-isolation</code></p>
<h4 id="3-3-事务隔离的实现"><a href="#3-3-事务隔离的实现" class="headerlink" title="3.3 事务隔离的实现"></a>3.3 事务隔离的实现</h4><blockquote>
<p>每条记录在更新的时候都会记录一条回滚操作，记录上的最新值通过回滚操作都能回到它上一个版本，同一条记录在系统中可以存在多个版本，这就是数据库的多版本并发控制（MVCC）</p>
</blockquote>
<h4 id="3-4-回滚日志"><a href="#3-4-回滚日志" class="headerlink" title="3.4 回滚日志"></a>3.4 回滚日志</h4><ul>
<li>回滚日志什么时候删除?<br>系统会判断当没有实物需要用到这些回滚日志的时候，回滚日志会被删除。</li>
<li>什么时候不需要？<br>当系统中没有比这个回滚日志更早的read-view的时候<h4 id="3-5-为什么尽量不使用长事务？"><a href="#3-5-为什么尽量不使用长事务？" class="headerlink" title="3.5 为什么尽量不使用长事务？"></a>3.5 为什么尽量不使用长事务？</h4><blockquote>
<p>长事务意味着系统里面会存在很老的事务视图，在这个事务提交之前，回滚记录都要保留，这会导致大量占用存储空间。除此之外，长事务还会占用锁资源，可能会拖垮整个库。</p>
</blockquote>
</li>
</ul>
<h2 id="4、5-深入浅出索引（上，下）"><a href="#4、5-深入浅出索引（上，下）" class="headerlink" title="4、5 深入浅出索引（上，下）"></a>4、5 深入浅出索引（上，下）</h2><h4 id="4-1-索引的实现方式有哪些"><a href="#4-1-索引的实现方式有哪些" class="headerlink" title="4.1 索引的实现方式有哪些"></a>4.1 索引的实现方式有哪些</h4><ul>
<li><p>哈希表</p>
<blockquote>
<p>将值放到数组里，然后用哈希函数将key换算为一个确定的位置 ，将value放到数组的这个位置，当哈希冲突时，会拉出一个链表进行保存。适用场景：只适合等值查询情况，不适合用于范围查询</p>
</blockquote>
</li>
<li><p>有序数组</p>
<blockquote>
<p>将值按顺序放入到数组中，可采用二分法查询，时间复杂度为O(lg(N))，但是插入比较麻烦，需要移动很多值。适用场景：不再变化的值。</p>
</blockquote>
</li>
<li><p>二叉树搜索树</p>
<blockquote>
<p>每个结点的左儿子小于父节点，右儿子大于父节点，平衡二叉树是搜索速度最快的数据结构，但是索引不仅存在于内存，也要存储到硬盘中，如果用平衡二叉树，那么100万的数据就是一个树高20的二叉树，对应磁盘就是20个数据块，要查询一个数据要访问20个数据块，这就很慢了。</p>
</blockquote>
</li>
<li><p>N叉树</p>
<blockquote>
<p>N叉树顾名思义就是每个节点有N儿子，儿子之间从左到右递增。它是为了解决二叉树占用数据块太多而产生的。</p>
</blockquote>
</li>
</ul>
<h4 id="4-2-Innodb引擎使用的索引"><a href="#4-2-Innodb引擎使用的索引" class="headerlink" title="4.2 Innodb引擎使用的索引"></a>4.2 Innodb引擎使用的索引</h4><blockquote>
<p>Innodb是使用B+树来存储数据的。每一张表其实就是由多个B+树组成的，树结点的key值就是某一行的主键，value是该行的其他数据。每一个索引都会创建一个B+树。</p>
</blockquote>
<h4 id="4-3-索引的类型"><a href="#4-3-索引的类型" class="headerlink" title="4.3 索引的类型"></a>4.3 索引的类型</h4><blockquote>
<p>索引分为主键索引和非主键索引，主键索引的叶子结点存放的是这一行的数据，而非主键索引的叶子结点存放的是主键索引的值。当使用主键索引去查询时可以直接获取到该行数据，而使用非主键索引去查询时，先拿到主键的值，再根据主键获取到该行数据，这个过程被称为<strong>回表</strong></p>
</blockquote>
<h4 id="4-4-覆盖索引"><a href="#4-4-覆盖索引" class="headerlink" title="4.4 覆盖索引"></a>4.4 覆盖索引</h4><p>表 user，id（主键），name（普通索引）</p>
<p>当我们想查询 name = 张三 的id 时我们可以使用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">'张三'</span></span><br></pre></td></tr></table></figure>

<p>这条语句的执行过程为：先去索引树name中找到张三拿到张三的id，再去主键索引树中根据id拿到这条记录，而我们只是需要它的id的，使用这条语句会进行一次回表操作，所以我们可以改为下面语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">name</span> = <span class="string">'张三'</span></span><br></pre></td></tr></table></figure>

<p>这种方式就叫做覆盖索引，我们可以通过一些联合索引的方式去避免进行二次回表操作。</p>
<h4 id="4-5-索引最左前缀"><a href="#4-5-索引最左前缀" class="headerlink" title="4.5 索引最左前缀"></a>4.5 索引最左前缀</h4><p>表 user，id（主键），gender（性别），name（姓名），age（年龄）<br>联合索引（name，age）</p>
<p>当我们查询姓张并且年龄为10岁的男孩时：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'张%'</span> <span class="keyword">and</span> age = <span class="number">10</span> <span class="keyword">and</span> gender = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>它会先找到第一个姓张的记录，然后再向后依次遍历，这种就避免了全表扫描。</p>
<blockquote>
<p>一般来说如果建立了 （a，b）联合索引，就不需要在a上单独建立一个索引了，但是如果是根据b来查，那么还是需要在b上建立索引。</p>
</blockquote>
<h2 id="6-全局锁和表级锁"><a href="#6-全局锁和表级锁" class="headerlink" title="6.全局锁和表级锁"></a>6.全局锁和表级锁</h2><h3 id="61-全局锁"><a href="#61-全局锁" class="headerlink" title="61. 全局锁"></a>61. 全局锁</h3><p>全局锁即是锁住整个数据库，mysql提供了一个加全局读锁的语句(FTWRL)：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">flush</span> <span class="keyword">table</span> <span class="keyword">with</span> <span class="keyword">read</span> <span class="keyword">lock</span></span><br></pre></td></tr></table></figure>

<p>加完全局读锁之后，数据库整个的更新，删除，添加语句都会被阻塞，这个使用场景就是数据库备份。但是让数据库处于只读状态，这种方式就会让所有更新被阻塞，整个业务就会停摆。这时我们可以使用官方为我们提供的数据库备份工具<code>mysqldump</code>，通过<code>--single-transaction</code>参数来确保拿到一致性视图:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">备份：mysqldump <span class="comment">--single-transaction -u用户名 -p密码 数据库名 &gt; back.sql</span></span><br><span class="line">恢复：mysql -u用户名 -p密码 -f 数据库名&lt; back.sql</span><br></pre></td></tr></table></figure>

<p>这样在备份数据库之前就会启动一个事务，来确保拿到一致性视图，采用这种方式数据库也可以正常更新的。但这种方式有种局限性，那就是必须支持事务，而<code>myisam</code>存储引擎就不支持事务，所以还是得采用全局锁的方式。</p>
<p><strong>问 : 让数据库处于只读状态为什么不用<code>set global readonly=true</code> ?</strong><br>这是因为使用<code>readonly</code>的话，一旦客户端出现异常，那么整个数据库都处于不可用状态了，而使用 <code>FTWRL</code>一旦客户端出现异常，那么就会自动释放这个锁，整个数据库即可恢复到正常状态（可读可写）。</p>
<h3 id="6-2-表级锁"><a href="#6-2-表级锁" class="headerlink" title="6.2 表级锁"></a>6.2 表级锁</h3><p>mysql中的表级锁有两种，一种就是表锁，另一种是元数据锁（MDL）：meta data lock。</p>
<h4 id="6-2-1-表锁"><a href="#6-2-1-表锁" class="headerlink" title="6.2.1 表锁"></a>6.2.1 表锁</h4><p>mysql添加表锁可采用下面语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lock</span> <span class="keyword">tables</span> 表名 <span class="keyword">read</span>,表名 write</span><br></pre></td></tr></table></figure>

<p>释放锁和FTWRL类似，当客户端出现异常后也会自动释放锁。也可手动释放：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unlock</span> <span class="keyword">tables</span> 表名</span><br></pre></td></tr></table></figure>

<h4 id="6-2-2-元数据锁（MDL）"><a href="#6-2-2-元数据锁（MDL）" class="headerlink" title="6.2.2 元数据锁（MDL）"></a>6.2.2 元数据锁（MDL）</h4><p>元数据锁是隐式锁，当访问某一张表时，数据库自动加的锁。</p>
<ul>
<li>当对表增删改查时：加MDL读锁</li>
<li>当更改表结构时：加MDL写锁</li>
</ul>
<p>读锁之间不互斥，也就是多个线程可以同时对一个表进行增删改查，但是读写锁和写写锁之间互斥，也即是当更改表结构时要等待读锁或写锁释放后才能进行更改。</p>
<p><strong>问：为什么我就给表加个字段，数据库就崩了？</strong><br>如果在更改表结构之前有一个长事务在操作表（MDL读锁），当我们去添加表中一个字段时那么这个操作会添加一个MDL写锁，由于读写锁互斥，那么这个MDL写锁就会被阻塞，以至于后面的增删改查操作要加MDL读锁的都会被阻塞下去。</p>
<p>为了更加安全的更改表结构我们可以使用下面语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alert table 表名 wait 5 add colunm 列名</span><br></pre></td></tr></table></figure>

<p>这个会等待5秒，如果5秒钟拿不到MDL写锁，那么就不再继续阻塞，也就可以后面的操作继续进行下去。</p>
<h2 id="7-行锁"><a href="#7-行锁" class="headerlink" title="7. 行锁"></a>7. 行锁</h2><p>行锁是在引擎层实现的，但不是每个引擎都支持行锁，像<code>MyISAM</code>引擎就不支持行锁，它想控制并发就只能加表锁。</p>
<blockquote>
<p>行锁是有需要时才添加的，但释放是在<strong>事务提交之后</strong>才进行释放的（两阶段锁），根据这个特性，如果你的事务中需要锁多个行，要把最可能造成锁冲突、最可能影响并发度的锁尽量往后放。</p>
</blockquote>
<p>举个例子：用户A在电影院B买一张电影票（3元）需要下面三个过程：</p>
<ol>
<li>从用户A账户中扣掉 3 元</li>
<li>在电影院B的余额中增加 3 元</li>
<li>记录一条交易日志</li>
</ol>
<p>这个三个过程是放在一个事务中的，但是 2 过程是最可能造成锁冲突的，因为其他用户买了票之后也要在电影院B的余额中增加 3 元，所以我们要把最可能造成锁冲突的放在后面，这样电影院B余额这一行的锁时间就最少，我们调整顺序为：3 、 1 、 2</p>
<h3 id="7-1-死锁和死锁检测"><a href="#7-1-死锁和死锁检测" class="headerlink" title="7.1 死锁和死锁检测"></a>7.1 死锁和死锁检测</h3><p><img src="https://img-blog.csdnimg.cn/20181218094720117.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2p1bm1veGk=,size_16,color_FFFFFF,t_70" alt></p>
<p>事务A在等待事务B释放id=2的行锁，而事务B在等待事务A释放id=1的行锁，事务A和事务B互相等待对方的资源释放，这就造成了死锁。</p>
<h4 id="死锁解决"><a href="#死锁解决" class="headerlink" title="死锁解决"></a>死锁解决</h4><ol>
<li>超时释放<br>设置超时时间，通过参数<code>innodb_lock_wait_timeout</code>设置，当超过这个时间之后将自动释放锁资源。默认是50s</li>
<li>死锁检测<br>设置<code>innodb_deadlock_detect</code>为on来开启死锁检测，但它会造成额外的负担，每当一个事务被锁的时候，就要看看它所依赖的线程有没有被别人锁住，如此循环，最后判断是否出现了循环等待，也就是死锁。</li>
</ol>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/09/29/Java桥接模式知识点总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/Java桥接模式知识点总结/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T22:56:39+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: Java桥接模式知识点总结<br>date: 2019-04-04 22:10:31<br>tags: [java,桥接模式,java桥接模式]<br>categories: Java</p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/09/29/response.setHeader的各种用法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/response.setHeader的各种用法/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T22:56:39+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: response.setHeader的各种用法<br>date: 2018-07-15 22:10:31<br>tags: [content-type,jsp,setHeader]<br>categories: jsp</p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/09/29/Shell入门实例/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/Shell入门实例/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T22:56:39+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: Shell入门实例<br>date: 2019-06-30 22:10:31<br>tags: [shell,awk]<br>categories: Linux,shell</p>
<h1 id="控制字符"><a href="#控制字符" class="headerlink" title="控制字符"></a>控制字符</h1><p>常见的控制字符有：<code>&amp;</code>，<code>&amp;&amp;</code>，<code>||</code>，<code>;</code>，<code>|</code></p>
<p><code>&amp;</code>: 将命令在后台执行<br><code>&amp;&amp;</code>: 前面的命令执行成功，后面的命令才会执行<br><code>||</code>: 前面的命令执行失败，后面的命令才会执行<br><code>;</code>:命令顺序执行，前面的命令执行成功与否，后面的命令都会执行<br><code>|</code>:管道符，前面命令的执行结果是后面命令的输入</p>
<h5 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h5><p>将命令在后台执行，可通过 <code>jobs</code> 命令查看当前后台执行的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar Test &amp;</span><br></pre></td></tr></table></figure>

<p>当test.txt存在时，查看该文件，只有ls test.txt执行成功后，才会执行 后面的 cat test.txt</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls test.txt &amp;&amp; cat test.txt</span><br></pre></td></tr></table></figure>

<p>如果有gedit编辑器则打开该程序，否则打开vim编辑器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gedit || vim</span><br></pre></td></tr></table></figure>

<p>命令依次执行，无论前面命令是否执行成功，后面的命令都会执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /tmp ; ls /root ; ls /home</span><br></pre></td></tr></table></figure>

<p>查看test.txt文件，并屏蔽其输出（扔到了 /dev/null黑洞里），如果前面命令执行成功，说明文件存在，则打印出文件存在，如果执行失败，说明文件不存在，则打印文件不存在</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat test.txt &gt; /dev/null &amp;&amp; <span class="built_in">echo</span> <span class="string">"文件存在"</span> || <span class="built_in">echo</span> <span class="string">"文件不存在"</span></span><br></pre></td></tr></table></figure>

<p>输出当前进程中有<code>bash</code>关键字的进程，前面<code>ps -a</code>的输出结果，是 <code>grep bash</code> 的输入参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -a | grep bash</span><br></pre></td></tr></table></figure>

<h1 id="参数变量"><a href="#参数变量" class="headerlink" title="参数变量"></a>参数变量</h1><ul>
<li><code>$@</code>所有参数列表，与 <code>$*</code>效果相同</li>
<li><code>$$</code> Shell本身的PID</li>
<li><code>$0</code>: Shell本身的文件名 </li>
<li><code>$1~n</code> 参数值，$1为第一个参数，$2为第二个参数。。。</li>
</ul>
<h4 id="实例-1"><a href="#实例-1" class="headerlink" title="实例"></a>实例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"shell脚本本身的名字: <span class="variable">$0</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"传给shell的第一个参数: <span class="variable">$1</span>"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"传给shell的第二个参数: <span class="variable">$2</span>"</span></span><br></pre></td></tr></table></figure>

<p>将其保存为 <code>test.sh</code>，执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash Test.sh 1 2</span><br></pre></td></tr></table></figure>

<p>输出结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shell脚本本身的名字: test.sh</span><br><span class="line">传给shell的第一个参数: 1</span><br><span class="line">传给shell的第二个参数:  2</span><br></pre></td></tr></table></figure>

<p><strong>常用脚本demo</strong><br>函数声明一定要在函数调用前面，不然会找不到，切记，和高级语言不一样！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="function"><span class="title">run</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"启动 <span class="variable">$1</span> 程序"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">stop</span></span>()&#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"关闭 <span class="variable">$1</span> 程序"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">restart</span></span>() &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"重启动 <span class="variable">$1</span> 程序"</span></span><br><span class="line">  stop <span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">  run <span class="string">"<span class="variable">$1</span>"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 帮助文档</span></span><br><span class="line"><span class="function"><span class="title">usage</span></span>() &#123;</span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"start: 启动程序 build.sh start 程序名"</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"stop:  停止程序 build.sh stop 程序名"</span></span><br><span class="line">   <span class="built_in">echo</span> <span class="string">"restart: 重启程序 build.sh restart 程序名"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">main</span></span>() &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="variable">$1</span> <span class="keyword">in</span></span><br><span class="line">        start)</span><br><span class="line">            run <span class="variable">$2</span></span><br><span class="line">            ;;</span><br><span class="line">        restart)</span><br><span class="line">            restart <span class="variable">$2</span></span><br><span class="line">            ;;</span><br><span class="line">        stop)</span><br><span class="line">            stop <span class="variable">$2</span></span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            usage</span><br><span class="line">            ;;</span><br><span class="line">    <span class="keyword">esac</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 执行main 函数，并将所有参数传递过去</span></span><br><span class="line">main <span class="string">"<span class="variable">$@</span>"</span></span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./build.sh stop docker</span><br></pre></td></tr></table></figure>

<h1 id="echo输出彩色字"><a href="#echo输出彩色字" class="headerlink" title="echo输出彩色字"></a>echo输出彩色字</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[30m 黑色字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[31m 红色字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[32m 绿色字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[33m 黄色字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[34m 蓝色字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[35m 紫色字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[36m 天蓝字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[37m 白色字 \033[0m"</span></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[40;37m 黑底白字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[41;37m 红底白字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[42;37m 绿底白字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[43;37m 黄底白字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[44;37m 蓝底白字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[45;37m 紫底白字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[46;37m 天蓝底白字 \033[0m"</span></span><br><span class="line"><span class="built_in">echo</span> -e <span class="string">"\033[47;30m 白底黑字 \033[0m"</span></span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/09/29/SpringBoot前后端数据传输加密/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/SpringBoot前后端数据传输加密/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T22:56:39+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: SpringBoot前后端数据传输加密<br>date: 2019-02-07 22:10:31<br>tags: [数据加密]<br>categories: Java,springboot,SpringBoot技能大全</p>
<p>采用的算法为AES算法</p>
<h1 id="1-编写加密工具类"><a href="#1-编写加密工具类" class="headerlink" title="1. 编写加密工具类"></a>1. 编写加密工具类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pibigstar.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前后端数据传输加密工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pibigstar</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AesEncryptUtils</span> </span>&#123;</span><br><span class="line">	<span class="comment">//可配置到Constant中，并读取配置文件注入</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY = <span class="string">"abcdef0123456789"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//参数分别代表 算法名称/加密模式/数据填充方式</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ALGORITHMSTR = <span class="string">"AES/ECB/PKCS5Padding"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 加密</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> content 加密的字符串</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> encryptKey key值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(String content, String encryptKey)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		KeyGenerator kgen = KeyGenerator.getInstance(<span class="string">"AES"</span>);</span><br><span class="line">		kgen.init(<span class="number">128</span>);</span><br><span class="line">		Cipher cipher = Cipher.getInstance(ALGORITHMSTR);</span><br><span class="line">		cipher.init(Cipher.ENCRYPT_MODE, <span class="keyword">new</span> SecretKeySpec(encryptKey.getBytes(), <span class="string">"AES"</span>));</span><br><span class="line">		<span class="keyword">byte</span>[] b = cipher.doFinal(content.getBytes(<span class="string">"utf-8"</span>));</span><br><span class="line">		<span class="keyword">return</span> Base64.encodeBase64String(b);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 解密</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> encryptStr 解密的字符串</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> decryptKey 解密的key值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decrypt</span><span class="params">(String encryptStr, String decryptKey)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		KeyGenerator kgen = KeyGenerator.getInstance(<span class="string">"AES"</span>);</span><br><span class="line">		kgen.init(<span class="number">128</span>);</span><br><span class="line">		Cipher cipher = Cipher.getInstance(ALGORITHMSTR);</span><br><span class="line">		cipher.init(Cipher.DECRYPT_MODE, <span class="keyword">new</span> SecretKeySpec(decryptKey.getBytes(), <span class="string">"AES"</span>));</span><br><span class="line">		<span class="keyword">byte</span>[] encryptBytes = Base64.decodeBase64(encryptStr);</span><br><span class="line">		<span class="keyword">byte</span>[] decryptBytes = cipher.doFinal(encryptBytes);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> String(decryptBytes);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(String content)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> encrypt(content, KEY);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decrypt</span><span class="params">(String encryptStr)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> decrypt(encryptStr, KEY);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		String content = <span class="string">"派大星"</span>;</span><br><span class="line">		System.out.println(<span class="string">"加密前："</span> + content);</span><br><span class="line"></span><br><span class="line">		String encrypt = encrypt(content, KEY);</span><br><span class="line">		System.out.println(<span class="string">"加密后："</span> + encrypt);</span><br><span class="line"></span><br><span class="line">		String decrypt = decrypt(encrypt, KEY);</span><br><span class="line">		System.out.println(<span class="string">"解密后："</span> + decrypt);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-前端"><a href="#2-前端" class="headerlink" title="2. 前端"></a>2. 前端</h1><p>js 文件下载：<a href="https://pan.baidu.com/s/11LnXUnsMtGW5C8sycf2SDQ" target="_blank" rel="noopener">https://pan.baidu.com/s/11LnXUnsMtGW5C8sycf2SDQ</a></p>
<p>导入 js 文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span> = <span class="string">"js/aes.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span> = <span class="string">"js/pad-zeropadding.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span> = <span class="string">"js/security.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>发送数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		alert(<span class="string">"发送的数据："</span>+Encrypt(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">name</span>:<span class="string">"派大星"</span>&#125;)));</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">	        type: <span class="string">"POST"</span>,</span><br><span class="line">	        url:<span class="string">"/save"</span>,</span><br><span class="line">	        data:Encrypt(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">name</span>:<span class="string">"派大星"</span>&#125;)),</span><br><span class="line">	        dataType:<span class="string">'json'</span>,</span><br><span class="line">	        contentType: <span class="string">"application/json"</span>,</span><br><span class="line">	        success: <span class="function"><span class="keyword">function</span>(<span class="params">resData</span>) </span>&#123;</span><br><span class="line">	        	alert(<span class="string">"返回的数据："</span>+resData);</span><br><span class="line">	        	alert(<span class="string">"解密之后："</span>+Decrypt(resData));</span><br><span class="line">	        	alert(<span class="string">"解密之后转json对象："</span>+<span class="built_in">JSON</span>.parse(Decrypt(resData)).name);</span><br><span class="line">	        &#125;</span><br><span class="line">		&#125;); </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/09/29/Maven+SpringMVC+Mybatis 整合使用教程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/Maven+SpringMVC+Mybatis 整合使用教程/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T22:56:39+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: Maven+SpringMVC+Mybatis 整合使用教程<br>date: 2018-06-12 22:10:31<br>tags: []<br>categories: Java,框架学习使用</p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/09/29/python打包成exe可执行文件/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/python打包成exe可执行文件/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T22:56:39+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: python打包成exe可执行文件<br>date: 2018-11-08 22:10:31<br>tags: [python,exe]<br>categories: pyhton</p>
<h1 id="安装-pyinstaller"><a href="#安装-pyinstaller" class="headerlink" title="安装 pyinstaller"></a>安装 pyinstaller</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyinstaller</span><br></pre></td></tr></table></figure>

<h1 id="打包"><a href="#打包" class="headerlink" title="打包"></a>打包</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyinstaller -F hello.py</span><br></pre></td></tr></table></figure>

<p>打包好的exe文件放在dist文件夹中</p>
<p>打包时加入<code>-w</code> 参数，那么执行 exe文件时将不会有小黑窗</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pyinstaller -F -w hello.py</span><br></pre></td></tr></table></figure>

<h2 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h2><p>如果打包过程中出现<code>ModuleNotFoundError: No module named &#39;setuptools._vendor&#39;</code> 错误，那么执行下列命令即可：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade setuptools</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/09/29/SpringBoot使用JSR303做参数校验/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/SpringBoot使用JSR303做参数校验/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T22:56:39+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: SpringBoot使用JSR303做参数校验<br>date: 2019-07-06 22:10:31<br>tags: [参数校验,jsr]<br>categories: springboot</p>
<h1 id="1-实体"><a href="#1-实体" class="headerlink" title="1. 实体"></a>1. 实体</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="keyword">private</span> Integer id;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="meta">@Length</span>(min=<span class="number">6</span>)</span><br><span class="line">	<span class="keyword">private</span> String password;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@NotNull</span></span><br><span class="line">	<span class="meta">@IsPhone</span> <span class="comment">//自定义的校验</span></span><br><span class="line">	<span class="keyword">private</span> String phone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>#2. Controller中使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(value=<span class="string">"login"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">login</span><span class="params">(@Valid User user)</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3-自定义校验"><a href="#3-自定义校验" class="headerlink" title="3. 自定义校验"></a>3. 自定义校验</h1><p>注解<code>IsPhone</code> 判断是否为手机号 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pibigstar.springboot.validator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.ANNOTATION_TYPE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.CONSTRUCTOR;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.FIELD;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.METHOD;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.PARAMETER;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.ElementType.TYPE_USE;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.lang.annotation.RetentionPolicy.RUNTIME;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Repeatable;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.Constraint;</span><br><span class="line"><span class="keyword">import</span> javax.validation.Payload;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target</span>(&#123; METHOD, FIELD, ANNOTATION_TYPE, CONSTRUCTOR, PARAMETER, TYPE_USE &#125;)</span><br><span class="line"><span class="meta">@Retention</span>(RUNTIME)</span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Constraint</span>(validatedBy = &#123;PhoneValidator.class&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> IsPhone &#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">boolean</span> <span class="title">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="function">String <span class="title">message</span><span class="params">()</span> <span class="keyword">default</span> "手机号不合法"</span>; <span class="comment">//错误默认提示信息</span></span><br><span class="line"></span><br><span class="line">	Class&lt;?&gt;[] groups() <span class="keyword">default</span> &#123; &#125;;</span><br><span class="line"></span><br><span class="line">	Class&lt;? extends Payload&gt;[] payload() <span class="keyword">default</span> &#123; &#125;;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="4-实现具体校验类"><a href="#4-实现具体校验类" class="headerlink" title="4. 实现具体校验类"></a>4. 实现具体校验类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pibigstar.springboot.validator;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintValidator;</span><br><span class="line"><span class="keyword">import</span> javax.validation.ConstraintValidatorContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 手机号码验证者</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pibigstar</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PhoneValidator</span> <span class="keyword">implements</span> <span class="title">ConstraintValidator</span>&lt;<span class="title">IsPhone</span>,<span class="title">String</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">boolean</span> requeired;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initialize</span><span class="params">(IsPhone constraintAnnotation)</span> </span>&#123;</span><br><span class="line">		requeired = constraintAnnotation.required();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span><span class="params">(String value, ConstraintValidatorContext context)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (requeired) &#123;</span><br><span class="line">			<span class="keyword">return</span> isPhone(value);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//phone 不是必须</span></span><br><span class="line">			<span class="keyword">if</span> (value==<span class="keyword">null</span>||value.length()==<span class="number">0</span>) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">			&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">				<span class="keyword">return</span> isPhone(value);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">isPhone</span><span class="params">(String phone)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//以1开头，后面跟10个整数，一共11位</span></span><br><span class="line">		Pattern phonePattern = Pattern.compile(<span class="string">"1\\d&#123;10&#125;"</span>);</span><br><span class="line">		<span class="keyword">if</span> (phone==<span class="keyword">null</span>||phone.length()&lt;=<span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			Matcher matcher = phonePattern.matcher(phone);</span><br><span class="line">			<span class="keyword">return</span> matcher.matches();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="5-对参数不通过进行统一捕获"><a href="#5-对参数不通过进行统一捕获" class="headerlink" title="5. 对参数不通过进行统一捕获"></a>5. 对参数不通过进行统一捕获</h1><p>参数验证不通过后统一格式返回给前端页面</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pibigstar.springboot.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.BindException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.validation.ObjectError;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ControllerAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ExceptionHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.pibigstar.springboot.domain.result.MyResponse;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalExceptionHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@ExceptionHandler</span>(value=Exception.class)</span><br><span class="line">	<span class="function"><span class="keyword">public</span> MyResponse <span class="title">exceptionHandler</span><span class="params">(HttpServletRequest request,Exception e)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//参数校验异常</span></span><br><span class="line">		<span class="keyword">if</span> (e <span class="keyword">instanceof</span> BindException) &#123;</span><br><span class="line">			BindException exception = (BindException) e;</span><br><span class="line">			List&lt;ObjectError&gt; allErrors = exception.getAllErrors();</span><br><span class="line">			ObjectError objectError = allErrors.get(<span class="number">0</span>);</span><br><span class="line">			String defaultMessage = objectError.getDefaultMessage();</span><br><span class="line">			<span class="keyword">return</span> MyResponse.error(defaultMessage);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="comment">//其他异常</span></span><br><span class="line">			<span class="keyword">return</span> MyResponse.error(e);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/09/29/Linux中用oneinstack安装Tomcat无法启动解决/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/09/29/Linux中用oneinstack安装Tomcat无法启动解决/" itemprop="url">Untitled</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2019-09-29T22:56:39+08:00">
                2019-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>title: Linux中用oneinstack安装Tomcat无法启动解决<br>date: 2019-07-24 22:10:31<br>tags: [tomcat,linux,oneinstack]<br>categories: 工具使用,Linux</p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/19/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/19/">19</a><span class="page-number current">20</span><a class="page-number" href="/page/21/">21</a><span class="space">&hellip;</span><a class="page-number" href="/page/24/">24</a><a class="extend next" rel="next" href="/page/21/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/qq.png" alt="派大星">
            
              <p class="site-author-name" itemprop="name">派大星</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">239</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/pibigstar" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/junmoxi" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-yelp"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-[object Object]"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">派大星</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>








        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
<!-- 页面点击小红心 -->
 <script type="text/javascript" src="/js/src/clicklove.js"></script>
